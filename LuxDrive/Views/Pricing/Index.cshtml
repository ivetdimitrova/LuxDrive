@{
    ViewData["Title"] = "Pricing - LuxDrive";

    bool isLoggedIn = User.Identity != null && User.Identity.IsAuthenticated;

    var currentPlan = isLoggedIn ? ViewBag.CurrentPlan as string : null;

    bool hasCard = ViewBag.HasCard is bool val && val;
}

@section Styles {
    <link rel="stylesheet" href="~/css/pricing.css" asp-append-version="true" />
}

<section class="hero" id="hero-section">
    <div class="hero-bg"></div>
    <div class="spotlight"></div>
    <canvas id="particles-canvas"></canvas>

    <img src="/images/gold-cloud.png" class="hero-cloud cloud-1" data-speed="0.05" data-depth="0.2" />
    <img src="/images/gold-cloud.png" class="hero-cloud cloud-2" data-speed="-0.06" data-depth="0.3" />
    <img src="/images/gold-cloud.png" class="hero-cloud cloud-5" data-speed="0.01" data-depth="0.1" />
    <img src="/images/gold-cloud.png" class="hero-cloud cloud-3" data-speed="0.04" data-depth="0.5" />
    <div class="hero-text">
        <h1>Select Your <span class="gold-shimmer">Plan</span></h1>
        <p>Unlock the full potential of LuxDrive. Simple pricing, no hidden fees.</p>
    </div>
</section>

<section class="features">

    <div class="feature" style="transition-delay: 0s;">
        <div>
            <h2>🎁 Free Plan</h2>
            <p>10 GB secure cloud storage. Perfect for getting started.</p>
            <div class="price-tag">€0.00 <span>/ free</span></div>
        </div>

        @if (!isLoggedIn)
        {
            <a asp-area="Identity" asp-page="/Account/Register" class="btn-glow">Sign Up Free</a>
        }
        else if (currentPlan == "None" || string.IsNullOrEmpty(currentPlan))
        {
            <button class="btn-glow active-plan">✓ Current Plan</button>
        }
        else
        {
            <a asp-controller="Pricing" asp-action="Downgrade" class="btn-downgrade">Switch to Free</a>
        }
    </div>

    <div class="feature" style="transition-delay: 0.2s;">
        <div>
            <h2>💼 Basic Plan</h2>
            <p>Perfect for personal backup. 50 GB secure storage.</p>
            <div class="price-tag">€4.99 <span>/ month</span></div>
        </div>

        @if (currentPlan == "Basic")
        {
            <button class="btn-glow active-plan">✓ Current Plan</button>
        }
        else if (currentPlan == "Pro" || currentPlan == "Enterprise")
        {
            <a asp-controller="Pricing" asp-action="QuickPurchase" asp-route-plan="Basic" class="btn-downgrade">Switch to Basic</a>
        }
        else
        {
            if (isLoggedIn)
            {
                if (hasCard)
                {
                    <a asp-controller="Pricing" asp-action="QuickPurchase" asp-route-plan="Basic" class="btn-glow">Get Started</a>
                }
                else
                {
                    <a asp-controller="Pricing" asp-action="Checkout" asp-route-plan="Basic" class="btn-glow">Get Started</a>
                }
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="/Pricing/Checkout?plan=Basic" class="btn-glow">Get Started</a>
            }
        }
    </div>

    <div class="feature" style="transition-delay: 0.4s;">
        <div>
            <h2>🚀 Pro Plan</h2>
            <p>For power users. 2 TB cloud storage & priority support.</p>
            <div class="price-tag">€14.99 <span>/ month</span></div>
        </div>

        @if (currentPlan == "Pro")
        {
            <button class="btn-glow active-plan">✓ Current Plan</button>
        }
        else if (currentPlan == "Enterprise")
        {
            <a asp-controller="Pricing" asp-action="QuickPurchase" asp-route-plan="Pro" class="btn-downgrade">Switch to Pro</a>
        }
        else
        {
            if (isLoggedIn)
            {
                if (hasCard)
                {
                    <a asp-controller="Pricing" asp-action="QuickPurchase" asp-route-plan="Pro" class="btn-glow">Upgrade</a>
                }
                else
                {
                    <a asp-controller="Pricing" asp-action="Checkout" asp-route-plan="Pro" class="btn-glow">Upgrade</a>
                }
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="/Pricing/Checkout?plan=Pro" class="btn-glow">Upgrade</a>
            }
        }
    </div>

    <div class="feature" style="transition-delay: 0.6s;">
        <div>
            <h2>🏢 Enterprise</h2>
            <p>Unlimited storage & full API access.</p>
            <div class="price-tag">Custom</div>
        </div>

        @if (currentPlan == "Enterprise")
        {
            <button class="btn-glow active-plan">✓ Current Plan</button>
        }
        else
        {
            <a asp-controller="Pricing" asp-action="ContactSales" class="btn-glow">Contact Sales</a>
        }
    </div>

</section>

@section Scripts {
    <script src="~/js/pricing.js" asp-append-version="true"></script>
}